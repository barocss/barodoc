---
// CodeGroup component for tabbed code blocks
interface Props {
  titles?: string[];
}

const { titles = [] } = Astro.props;
---

<div class="code-group not-prose my-4 rounded-lg border border-[var(--color-border)] overflow-hidden" data-titles={JSON.stringify(titles)}>
  <div class="code-group-tabs flex flex-wrap gap-0 border-b border-[var(--color-border)] bg-[var(--color-bg-tertiary)]"></div>
  <div class="code-group-content bg-[var(--color-bg-secondary)] px-5 py-4">
    <slot />
  </div>
</div>

<script>
  function initCodeGroups() {
    document.querySelectorAll('.code-group').forEach((group) => {
      const tabsContainer = group.querySelector('.code-group-tabs');
      const contentContainer = group.querySelector('.code-group-content');
      const titles = JSON.parse(group.getAttribute('data-titles') || '[]');
      const codeBlocks = contentContainer?.querySelectorAll('pre');

      if (!tabsContainer || !contentContainer || !codeBlocks?.length) return;

      // Create tabs
      codeBlocks.forEach((block, index) => {
        const tab = document.createElement('button');
        tab.className = 'shrink-0 px-4 py-2 text-sm font-medium transition-colors whitespace-nowrap text-[var(--color-text-muted)] hover:text-[var(--color-text)]';
        tab.textContent = titles[index] || `Tab ${index + 1}`;
        tab.addEventListener('click', () => {
          tabsContainer.querySelectorAll('button').forEach((t, i) => {
            if (i === index) {
              t.classList.add('border-b-2', 'border-primary-500', 'text-[var(--color-text)]', '-mb-px');
              t.classList.remove('text-[var(--color-text-muted)]');
            } else {
              t.classList.remove('border-b-2', 'border-primary-500', 'text-[var(--color-text)]', '-mb-px');
              t.classList.add('text-[var(--color-text-muted)]');
            }
          });
          codeBlocks.forEach((b, i) => {
            (b as HTMLElement).style.display = i === index ? 'block' : 'none';
          });
        });
        tabsContainer.appendChild(tab);

        if (index === 0) {
          tab.classList.add('border-b-2', 'border-primary-500', 'text-[var(--color-text)]', '-mb-px');
          tab.classList.remove('text-[var(--color-text-muted)]');
        } else {
          (block as HTMLElement).style.display = 'none';
        }
      });
    });
  }

  initCodeGroups();
  document.addEventListener('astro:page-load', initCodeGroups);
</script>
