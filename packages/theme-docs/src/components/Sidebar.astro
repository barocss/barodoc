---
import config from "virtual:barodoc/config";
import { defaultLocale } from "virtual:barodoc/i18n";
import { getLocalizedNavGroup } from "@barodoc/core";

interface Props {
  currentPath: string;
  currentLocale?: string;
}

const { currentPath, currentLocale = defaultLocale } = Astro.props;

// Normalize path for comparison
function normalizePath(path: string): string {
  return path.replace(/\/$/, '').replace(/^\//, '');
}

function isActive(page: string): boolean {
  const normalized = normalizePath(currentPath);
  const pagePath = normalizePath(page);
  return normalized === pagePath || 
    normalized === `docs/${pagePath}` ||
    normalized === `${currentLocale}/docs/${pagePath}`;
}

function getPageHref(page: string): string {
  if (currentLocale === defaultLocale) {
    return `/docs/${page}`;
  }
  return `/${currentLocale}/docs/${page}`;
}

// Get page title from the page slug
function getPageTitle(page: string): string {
  const parts = page.split('/');
  const name = parts[parts.length - 1];
  return name
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}
---

<nav class="space-y-6">
  {config.navigation.map((group) => (
    <div>
      <h3 class="text-xs font-semibold uppercase tracking-wider text-[var(--color-text-secondary)] mb-2">
        {getLocalizedNavGroup(group, currentLocale, defaultLocale)}
      </h3>
      <ul class="space-y-1">
        {group.pages.map((page) => (
          <li>
            <a
              href={getPageHref(page)}
              class:list={[
                "block px-3 py-1.5 text-sm rounded-md transition-colors",
                isActive(page)
                  ? "bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 font-medium"
                  : "text-[var(--color-text-secondary)] hover:text-[var(--color-text)] hover:bg-[var(--color-bg-secondary)]"
              ]}
            >
              {getPageTitle(page)}
            </a>
          </li>
        ))}
      </ul>
    </div>
  ))}
</nav>
