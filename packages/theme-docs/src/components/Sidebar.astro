---
import config from "virtual:barodoc/config";
import { defaultLocale } from "virtual:barodoc/i18n";
import { getLocalizedNavGroup } from "@barodoc/core";
import { SidebarWrapper } from "./SidebarWrapper";

interface Props {
  currentPath: string;
  currentLocale?: string;
}

const { currentPath, currentLocale = defaultLocale } = Astro.props;

// Normalize path for comparison
function normalizePath(path: string): string {
  return path.replace(/\/$/, '').replace(/^\//, '');
}

function isActive(page: string): boolean {
  const normalized = normalizePath(currentPath);
  const pagePath = normalizePath(page);
  const docsSlug = currentLocale === defaultLocale ? pagePath : `ko/${pagePath}`;
  return normalized === `docs/${pagePath}` || normalized === `docs/${docsSlug}`;
}

function getPageHref(page: string): string {
  return currentLocale === defaultLocale ? `/docs/${page}` : `/docs/ko/${page}`;
}

// Get page title from the page slug
function getPageTitle(page: string): string {
  const parts = page.split('/');
  const name = parts[parts.length - 1];
  return name
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}

// Transform config.navigation to the format expected by DocsSidebar
const groups = config.navigation.map((group) => ({
  title: getLocalizedNavGroup(group, currentLocale, defaultLocale),
  defaultOpen: true,
  items: group.pages.map((page) => ({
    title: getPageTitle(page),
    href: getPageHref(page),
    isActive: isActive(page),
  })),
}));
---

<SidebarWrapper groups={groups} client:load />
