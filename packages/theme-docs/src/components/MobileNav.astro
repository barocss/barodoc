---
import { MobileNavSheet } from "./MobileNavSheet";
import config from "virtual:barodoc/config";
import { defaultLocale } from "virtual:barodoc/i18n";
import { getLocalizedNavGroup } from "@barodoc/core";

interface Props {
  currentPath: string;
  currentLocale?: string;
}

const { currentPath, currentLocale = defaultLocale } = Astro.props;

// Normalize path for comparison
function normalizePath(path: string): string {
  return path.replace(/\/$/, '').replace(/^\//, '');
}

function isActive(page: string): boolean {
  const normalized = normalizePath(currentPath);
  const pagePath = normalizePath(page);
  return normalized === pagePath || 
    normalized === `docs/${pagePath}` ||
    normalized === `${currentLocale}/docs/${pagePath}`;
}

function getPageHref(page: string): string {
  if (currentLocale === defaultLocale) {
    return `/docs/${page}`;
  }
  return `/${currentLocale}/docs/${page}`;
}

// Get page title from the page slug
function getPageTitle(page: string): string {
  const parts = page.split('/');
  const name = parts[parts.length - 1];
  return name
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}

// Transform config.navigation to the format expected by MobileNavSheet
const groups = config.navigation.map((group) => ({
  title: getLocalizedNavGroup(group, currentLocale, defaultLocale),
  defaultOpen: true,
  items: group.pages.map((page) => ({
    title: getPageTitle(page),
    href: getPageHref(page),
    isActive: isActive(page),
  })),
}));
---

<MobileNavSheet 
  client:load 
  groups={groups} 
  siteName={config.name}
  logo={config.logo}
/>
